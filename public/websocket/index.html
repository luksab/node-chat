<!DOCTYPE html>
<html lang="en">
<head>
    <title>Cool chat</title>
    <meta name="Description" content="A very cool chat.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2F3BA2"/>
    <!--<link rel="manifest" href="/static/manifest.json">-->
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon16.png" />
    <link rel="apple-touch-icon" href="/images/icons/icon-192x192.png">
    <link rel="stylesheet" href="/index.css" media="none" onload="if(media!='all')media='all'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" async></script>
    <script src="https://rawgit.com/farzher/fuzzysort/master/fuzzysort.js" async></script>
    <script src='/indexWebsocket.js' async></script>
    <script>
        const b64toBlob = (b64Data, contentType='', sliceSize=512) => {
        const byteCharacters = atob(b64Data);
        const byteArrays = [];

        for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            const slice = byteCharacters.slice(offset, offset + sliceSize);

            const byteNumbers = new Array(slice.length);
            for (let i = 0; i < slice.length; i++) {
            byteNumbers[i] = slice.charCodeAt(i);
            }

            const byteArray = new Uint8Array(byteNumbers);
            byteArrays.push(byteArray);
        }
            
        const blob = new Blob(byteArrays, {type: contentType});
            return blob;
        }

        const contentType = 'image/png';
        const b64Data = 'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==';

        const blob = b64toBlob(b64Data, contentType);
        const blobUrl = URL.createObjectURL(blob);

        const img = document.createElement('img');
        img.src = blobUrl;

        blob.arrayBuffer().then((arrayBuff)=>{
            arr = new Uint8Array(arrayBuff);
            arr = [0,0,0,1,0].concat(...arr);
            buf = new Uint8Array(arr).buffer;

            arr2= new Uint8Array(buf);
        });


        //document.querySelector("#connecting").appendChild(img);
    </script>
</head>
<body>
<div style="overflow:hidden;height:100vh" >	
    <nav>
    <div id="mySidenav" class="sidenav">
        <div>
        <a href="javascript:void(0)" class="closebtn" onclick="return cycleNavBar()">&times;</a>
        <a href="javascript:void(0)" class="settbtn" onclick="return openSettings()">&#9881;</a>
        </div>
        <div id="contacts" align=center style="margin: 2.5em 0.5em 0.5em 0.5em;">
                <div id="contactSearch">
                <input type="search" dir="auto" id="contactsSearch" title="Suchen oder neuen Chat beginnen" value="">
                </div>
                <div id="nicknames"></div>
        </div>
        <a href="/static/datenschutz.html">Datenschutzerkl√§rung</a><b></b>
        <a href="/static/impressum.html">Impressum</a>
    </div>
    </nav>
    <header>
    <span style="font-size:1em;cursor:pointer" onclick="return cycleNavBar()">&#9776; Cool Chat</span>
    </header>
    <main>
    <div align=center id="chat" class="chat">
        <div id="nickname">
            <form class="wrap" id="set-nickname">
                <label for="nick">Please type in your password and press enter.</label>
                <input id="passwd" aria-label="password" type="password" placeholder="password (optional)" autocomplete="new-password"/>
                <input type="submit" id="register" value="Register" margin = "10px">
                <p id="nickname-err">Wrong password or other error...please try again</p>
            </form>
        </div>
        <div id="connecting">
            <div class="wrap">Connecting to server...</div>
        </div>
        <div id="messages" onclick="return cycleNavBar(true)">
            <div id="lines"></div>
        </div>
        <form id="send-message" style="display:flex;">
            <input id="message" type="text" autocomplete="off" disabled aria-label="message"/>
            <div class="filebutton">Send Image<input type="file" id="imagefile" accept="image/*" disabled aria-label="send image"></div>
        </form>
        </div>
    </div>
    </main>

    <!-- initially hidden right-click menu -->
    <div class="hide" id="rmenu">
        
    </div>

    <!-- initially hidden user menu -->
    <div id="umenu" onclick="return closeSettings(event)">
        <div style="position: relative;width: fit-content;left: 50%;transform: translateX(-50%);">
            
        </div>
    </div>

    <div id="settingsMenu" onclick="return closeSettings(event)">
    <div style="position: relative;width: fit-content;left: 50%;transform: translateX(-50%);">
        <a href="javascript:void(0)" class="pushButton"></a>
        <a href="javascript:void(0)" id="Logout">Logout</a>
        <a href="javascript:void(0)" id="Reload">Reload</a>
    </div>
    </div>
</body>
</html>
