var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,n){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(x){this.asyncThrow_(x)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(p){b.reject(p)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(n){c||(c=!0,a.call(b,n))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(p){this.reject_(p);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)l.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var l=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(x){c.reject(x)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(v){n(v)}}:
b}var d,n,l=new e(function(a,b){d=a;n=b});this.callWhenSettled_(c(a,d),c(b,n));return l};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?l.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,
d){for(var e=$jscomp.makeIterator(a),n=e.next();!n.done;n=e.next())c(n.value).callWhenSettled_(b,d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function n(b){return function(c){l[b]=c;p--;0==p&&a(l)}}var l=[],p=0;do l.push(void 0),p++,c(d.value).callWhenSettled_(n(l.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(l){return this.context_.yieldAllIterator_=null,this.context_.throw_(l),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function l(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(l,e)}l(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");function cycleNavBar(a){window.matchMedia("(min-width: 800px)").matches||("25em"==document.getElementById("mySidenav").style.width?document.getElementById("mySidenav").style.width="0":a||(document.getElementById("mySidenav").style.width="25em"));return!1}
window.onresize=function(a){window.matchMedia("(min-width: 800px)").matches&&"0px"==document.getElementById("mySidenav").style.width&&(document.getElementById("mySidenav").style.width="25em")};
window.onload=function(){function a(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/\-/g,"+").replace(/_/g,"/");a=window.atob(a);b=new Uint8Array(a.length);for(var f=0;f<a.length;++f)b[f]=a.charCodeAt(f);return b}function b(){t.addEventListener("click",function(){t.disabled=!0;w?l():e()});A.pushManager.getSubscription().then(function(a){w=null!==a;d(a);w?console.log("User IS subscribed."):console.log("User is NOT subscribed.");c()})}function c(){"denied"===Notification.permission?(t.textContent=
"Push Messaging Blocked.",t.disabled=!0,d(null)):(t.textContent=w?"Disable Push Messaging":"Enable Push Messaging",t.disabled=!1)}function d(a){k.emit("push",a);console.log(JSON.stringify(a))}function e(){var b=a("BM_12EMi2xCAVhD2tn_gr3DugdW_bYnxtVCJd1qzAZTag5gi-IH97Vetc5sYfr155JiPGceLMVMXy29GmFCES20");A.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:b}).then(function(a){console.log("User is subscribed.");d(a);w=!0;c()}).catch(function(a){console.log("Failed to subscribe the user: ",
a);c()})}function l(){A.pushManager.getSubscription().then(function(a){if(a)return a.unsubscribe()}).catch(function(a){console.log("Error unsubscribing",a)}).then(function(){d(null);console.log("User is unsubscribed.");w=!1;c()})}function n(a){try{return B.transaction(["messages"],"readwrite").objectStore("messages").index("chat").openCursor().onsuccess=function(b){(b=event.target.result)&&a===b.value.chat&&(g.innerHTML+="<p><b>"+b.value.sender+"</b>"+b.value.message+"</p>",b.continue())},!0}catch(h){return console.log(h),
!1}}function D(a,b,c){console.log({chat:a,sender:b,message:c});try{var f=B.transaction(["messages"],"readwrite").objectStore("messages").add({chat:a,sender:b,message:c});f.onsuccess=function(a){console.log("done with insert")};f.onerror=function(a){console.error(a)}}catch(J){console.log(J)}}function p(a,b){D(m,a,b);r.hasOwnProperty(m)||(r[m]=[]);r[m].push({from:a,msg:b});g.innerHTML+="<p><b>"+a+"</b>"+b+"</p>";setTimeout(function(){return g.scrollTop=g.scrollHeight})}function x(a,b){G.push({from:a,
msg:b});"allChat"==m&&(g.innerHTML+="<p><b>"+a+"</b>"+b+"</p>",setTimeout(function(){return g.scrollTop=Number.MAX_SAFE_INTEGER}))}function y(a,b){g.innerHTML+="<p><b>"+a+"</b>"+b+"</p>";setTimeout(function(){return g.scrollTop=Number.MAX_SAFE_INTEGER})}function F(a,b){g.innerHTML+="<p><b>"+a+'</b><img background-image src="'+b+'" width="'+((g.clientWidth|0)-20)+'"/></p>';setTimeout(function(){return g.scrollTop=Number.MAX_SAFE_INTEGER})}function H(a,b){var f=(g.clientWidth|0)-20,c=document.createElement("p"),
d=document.createElement("b");c.appendChild(d);d.appendChild(document.createTextNode(""+a));b.style="width :"+f;c.appendChild(b);g.appendChild(c);setTimeout(function(){return g.scrollTop=Number.MAX_SAFE_INTEGER})}function I(a,b){a.slice?a=a.slice(0,131072):a.webkitSlice&&(a=a.webkitSlice(0,131072));var f=new FileReader;f.onload=function(a){a=new DataView(a.target.result);if(65496!=a.getUint16(0,!1))b(-2);else{for(var f=a.byteLength,c=2;c<f;){var d=a.getUint16(c,!1);c+=2;if(65505==d){if(1165519206!=
a.getUint32(c+=2,!1)){b(-1);return}d=18761==a.getUint16(c+=6,!1);c+=a.getUint32(c+4,d);var e=a.getUint16(c,d);c+=2;for(var h=0;h<e;h++)if(274==a.getUint16(c+12*h,d)){b(a.getUint16(c+12*h+8,d));return}}else if(65280!=(d&65280))break;else c+=a.getUint16(c,!1)}b(-1)}};f.readAsArrayBuffer(a)}function E(a,b,c,d,e,g){var f=new Image;f.onerror=function(){URL.revokeObjectURL(this.src);g(a)};f.onload=function(){URL.revokeObjectURL(this.src);I(a,function(a){var b=f.width,e=f.height,h=4<a?Math.min(d/b,c/e,1):
Math.min(c/b,d/e,1);e=Math.round(e*h);b=Math.round(b*h);h=e;e=document.createElement("canvas");4<a?(e.width=h,e.height=b):(e.width=b,e.height=h);1<a&&console.log("EXIF orientation = "+a+", rotating picture");var q=e.getContext("2d");switch(a){case 2:q.transform(-1,0,0,1,b,0);break;case 3:q.transform(-1,0,0,-1,b,h);break;case 4:q.transform(1,0,0,-1,0,h);break;case 5:q.transform(0,1,1,0,0,0);break;case 6:q.transform(0,1,-1,0,h,0);break;case 7:q.transform(0,-1,-1,0,h,b);break;case 8:q.transform(0,-1,
1,0,0,b)}q.drawImage(f,0,0,b,h);a=e.toDataURL("image/jpeg",.7);g(a,e)})};f.src=URL.createObjectURL(a)}(function(a){a.event.fix=function(a){return function(b){b=a.apply(this,arguments);if(0===b.type.indexOf("copy")||0===b.type.indexOf("paste"))b.clipboardData=b.originalEvent.clipboardData;return b}}(a.event.fix);var b={callback:a.noop,matchType:/image.*/};return a.fn.pasteImageReader=function(f){"function"===typeof f&&(f={callback:f});f=a.extend({},b,f);return this.each(function(){var b=this;return a(this).bind("paste",
function(a){var c=!1;var d=a.clipboardData;return Array.prototype.forEach.call(d.types,function(a,e){if(!c&&(a.match(f.matchType)||d.items[e].type.match(f.matchType))){var h=d.items[e].getAsFile();a=new FileReader;a.onload=function(a){return f.callback.call(b,{dataURL:a.target.result,event:a,file:h,name:h.name})};a.readAsDataURL(h);return c=!0}})})})}})(jQuery);window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||
window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var v=window.indexedDB.open("messages",1);v.onerror=function(a){console.log(a)};var B;v.onsuccess=function(a){console.log("Database initialised");B=v.result};v.onupgradeneeded=function(a){a=a.target.result;a.onerror=function(a){console.log("Error loading database.")};objectStore=a.createObjectStore("messages",{keyPath:"id",autoIncrement:!0});objectStore.createIndex("chat",
"chat",{unique:!1});objectStore.createIndex("sender","sender",{unique:!1});objectStore.createIndex("message","message",{unique:!1});console.log("Object store created.")};var g=document.getElementById("lines"),z=document.getElementById("contactsSearch"),m,r={},G=[],u=[],w=!1,A=null,t=document.querySelector(".pushPushButton");"serviceWorker"in navigator&&"PushManager"in window?(console.log("Service Worker and Push is supported"),navigator.serviceWorker.register("/static/service-worker.js").then(function(a){console.log("Service Worker is registered",
a);A=a;b()}).catch(function(a){console.error("Service Worker Error",a)})):(console.warn("Push messaging is not supported"),t.textContent="Push Not Supported");document.getElementById("Logout").addEventListener("click",function(){try{l()}catch(f){}localStorage.clear();location.reload();return!1});var k=io.connect();k.on("connect",function(){$("#chat").addClass("connected");null!==localStorage.getItem("name")&&null!==localStorage.getItem("passwd")&&(console.log("Trying to login using saved Userdata"),
k.emit("nickname",{nick:localStorage.getItem("name"),passwd:localStorage.getItem("passwd")},function(a){if(!a)return y("System","Reconnected to the server with localStorage"),document.getElementById("message").disabled=!1,document.getElementById("imagefile").disabled=!1,$("#chat").addClass("nickname-set")}))});k.on("announcement",function(a){$("#lines").append($("<p>").append($("<em>").text(a)))});k.on("reload",function(){return location.reload()});k.on("nicknames",function(a){u=a;$("#nicknames").empty().append($("<span>Online: </span>"));
$("#nicknames").append($("<b>").text("allChat"));for(var b in u)$("#nicknames").append($(u[b]===localStorage.getItem("name")?'<b style="background: coral">':"<b>").text(u[b]))});document.getElementById("nicknames").addEventListener("click",function(a){a=a.target;if("B"==a.tagName&&a.innerText!==localStorage.getItem("name"))if(cycleNavBar(),m=a.innerText,document.getElementsByTagName("span")[1].innerText="\u2630 "+("allChat"===m?"Cool Chat":m),g.innerHTML="","allChat"===m){var b=$jscomp.makeIterator(G);
for(a=b.next();!a.done;a=b.next())el=a.value,g.innerHTML+="<p><b>"+el.from+"</b>"+el.msg+"</p>"}else if(!n(m)&&null!=r[m])for(b=$jscomp.makeIterator(r[m]),a=b.next();!a.done;a=b.next())a=a.value,g.innerHTML+="<p><b>"+a.from+"</b>"+a.msg+"</p>"});k.on("user message",function(a,b){return x(a,b)});k.on("user image",F);k.on("dm",function(a){console.log("dm");a.from==m?p(a.from,a.msg):(D(a.from,a.from,a),r.hasOwnProperty(a.from)||(r[a.from]=[]),r[a.from].push({from:a.from,msg:a.msg}))});k.on("reconnect",
function(){k.emit("nickname",{nick:localStorage.getItem("name"),passwd:localStorage.getItem("passwd")},function(a){if(!a)return $("#message").val("").focus(),document.getElementById("message").disabled=!1,document.getElementById("imagefile").disabled=!1,$("#chat").addClass("nickname-set");l();location.reload()});y("System","Reconnected to the server")});k.on("disconnect",function(){return y("System","Disconnected")});k.on("error",function(a){y("System",a?a:"A unknown error occurred")});z.onchange=
z.onkeyup=z.onclick=function(){if(""!=z.value){nicks=fuzzysort.go(z.value,Object.values(u),{threshold:-999});console.log(nicks);$("#nicknames").empty().append($("<span>Online: </span>"));$("#nicknames").append($("<b>").text("allChat"));for(var a in nicks)$("#nicknames").append($("<b>").text(nicks[a].target))}else for(a in $("#nicknames").empty().append($("<span>Online: </span>")),$("#nicknames").append($("<b>").text("allChat")),u)$("#nicknames").append($("<b>").text(u[a]))};$(function(){document.getElementById("register").onclick=
function(){localStorage.setItem("name",$("#nick").val());localStorage.setItem("passwd",$("#passwd").val());k.emit("nickname",{nick:$("#nick").val(),passwd:$("#passwd").val()},function(a){if(!a)return $("#message").val("").focus(),document.getElementById("message").disabled=!1,document.getElementById("imagefile").disabled=!1,$("#chat").addClass("nickname-set");$("#nickname-err").css("visibility","visible")});return!1};$("#send-message").submit(function(){if(m)return p("me",$("#message").val()),console.log("dm",
m,$("#message").val()),k.emit("dm",{user:m,msg:$("#message").val()}),$("#message").val("").focus(),$("#lines").get(0).scrollTop=Number.MAX_SAFE_INTEGER,!1;y("me",$("#message").val());k.emit("user message",$("#message").val());$("#message").val("").focus();$("#lines").get(0).scrollTop=Number.MAX_SAFE_INTEGER;return!1});$("#imagefile").bind("change",function(a){E(this.files[0],512E3,600,Infinity,.7,function(a){F("me",a);k.emit("user image",a)})});$("#message").pasteImageReader(function(a){console.log(a.dataURL.type);
console.log(a);a=function(a,b,c){b=void 0===b?"":b;c=void 0===c?512:c;a=atob(a);for(var d=[],e=0;e<a.length;e+=c){for(var f=a.slice(e,e+c),h=Array(f.length),g=0;g<f.length;g++)h[g]=f.charCodeAt(g);f=new Uint8Array(h);d.push(f)}return new Blob(d,{type:b})}(a.dataURL.slice(22),a.dataURL.slice(5,a.dataURL.indexOf(";")));E(a,512E3,600,Infinity,.7,function(a,b){H("me",b);k.emit("user image",a)})})});HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,
b,c){c=atob(this.toDataURL(b,c).split(",")[1]);for(var d=c.length,e=new Uint8Array(d),f=0;f<d;f++)e[f]=c.charCodeAt(f);a(new Blob([e],{type:b||"image/png"}))}});window.URL=window.URL||window.webkitURL;var C;window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-384"},!1,["deriveKey"]).then(function(a){C=a;window.crypto.subtle.exportKey("jwk",C.publicKey).then(function(a){k.emit("establishEncryption",a)}).catch(function(a){console.error(a)})});k.on("establishEncryption",function(a,b){window.crypto.subtle.importKey("jwk",
b,{name:"ECDH",namedCurve:"P-384"},!1,["deriveKey"]).then(function(a){console.log(a);window.crypto.subtle.deriveKey({name:"ECDH",public:a},C.privateKey,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]).then(function(a){console.log(a)})})})};